<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ejemplo GTFS &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
    <link rel="prev" title="Ejemplo Geoservicio realtime" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html">Introducción a las Smart Cities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html">Conceptos básicos de Geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html#geoservicio">Geoservicio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html">Conceptos sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html">Conceptos Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html">Utilización de servicios Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplo-api-ckan">Ejemplo API CKAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplos-api-socrata">Ejemplos API SOCRATA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html">Servicios realtime Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#problemas-frecuentes-al-trabajar-con-servicios-open-data">Problemas frecuentes al trabajar con servicios Open Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-malas-practicas">Ejemplo de malas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html">Herramientas de visualización Opendata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html">Ejemplo servicio bicing Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#acceso-al-servicio-de-datos-del-bicing-de-barcelona">Acceso al servicio de datos del Bicing de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#creacion-de-un-visor">Creación de un visor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#creacion-del-proxy">Creación del proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html">Servicios realtime sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#problemas-frecuentes-al-trabajar-con-sensores">Problemas frecuentes al trabajar con sensores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-malas-practicas">Ejemplo de malas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html">Ejemplo sensores port Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona">Acceso al servicio de datos de sensores del Port de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#creacion-de-un-visor">Creación de un visor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html">Ejemplo Sentilo ACA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#acceso-al-servicio-de-sensores-sentilo-de-la-aca">Acceso al servicio de sensores Sentilo de la ACA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#creacion-de-un-visor">Creación de un visor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#creacion-del-proxy">Creación del proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html">Geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#id1">Geoservicios realtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#geocodificacion">Geocodificación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#routing">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#isocronas">Isócronas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#servicios-varios">Servicios varios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html">Herramientas de visualización geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html">Ejemplo Mapzen Mobility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html#nota">NOTA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html">Ejemplo Geoservicio realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#servicio-realtime-para-compartir-la-ubicacion">Servicio realtime para compartir la ubicación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#creacion-del-mapa">Creación del mapa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios">Creación del servicio que comparte la ubicación de los usuarios</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Ejemplo GTFS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#que-es-la-gtfs">¿Qué es la GTFS?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creacion-de-un-visor-que-muestre-las-lines-y-paradas-de-un-gtfs">Creación de un visor que muestre las línes y paradas de un GTFS</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Ejemplo GTFS</a><ul>
<li><a class="reference internal" href="#que-es-la-gtfs">¿Qué es la GTFS?</a></li>
<li><a class="reference internal" href="#creacion-de-un-visor-que-muestre-las-lines-y-paradas-de-un-gtfs">Creación de un visor que muestre las línes y paradas de un GTFS</a><ul>
<li><a class="reference internal" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html" title="Previous Chapter: Ejemplo Geoservicio realtime"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Ejemplo Geose...</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ejemplo-gtfs/ejemplo-gtfs.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="ejemplo-gtfs">
<h1>Ejemplo GTFS<a class="headerlink" href="#ejemplo-gtfs" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8 Noviembre 2017</td>
<td><ul class="first last simple">
<li>Wladimir Szczerban</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2017 Wladimir Szczerban</p>
</div></blockquote>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia: Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="que-es-la-gtfs">
<h2>¿Qué es la GTFS?<a class="headerlink" href="#que-es-la-gtfs" title="Permalink to this headline">¶</a></h2>
<p>La Especificación general de feeds de transporte público (GTFS) define un formato común para los horarios de transporte público y la información geográfica asociada a ellos. Los &#8220;feeds&#8221; GTFS permiten que las empresas de transporte público publiquen sus datos de transporte y que los programadores escriban aplicaciones que consuman esos datos de manera interoperable. <a class="footnote-reference" href="#id8" id="id1">[1]</a></p>
</div>
<div class="section" id="creacion-de-un-visor-que-muestre-las-lines-y-paradas-de-un-gtfs">
<h2>Creación de un visor que muestre las línes y paradas de un GTFS<a class="headerlink" href="#creacion-de-un-visor-que-muestre-las-lines-y-paradas-de-un-gtfs" title="Permalink to this headline">¶</a></h2>
<p>Para crear un visor de mapas utilizaremos la librería de mapas Leaflet <a class="footnote-reference" href="#id9" id="id2">[2]</a>. Y cargaremos los datos de portal de la Plataforma VLCi (Valencia SmartCity) <a class="footnote-reference" href="#id10" id="id3">[3]</a></p>
<ol class="arabic">
<li><p class="first">Crear una carpeta con el nombre de <em>visor-gtfs</em>.</p>
</li>
<li><p class="first">Crear un archivo con el nombre de <em>index.html</em> dentro de la carpeta.</p>
</li>
<li><p class="first">Abrir el archivo index.html con un editor de texto y copiar el siguiente código.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
        &lt;title&gt;Ejemplo GTFS&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.css&quot; /&gt;
        &lt;style&gt;
        #map {
            height: 100%;
            width: 100%;
            position: absolute;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

        &lt;div id=&quot;map&quot;&gt;

    &lt;/div&gt;

        &lt;script src=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.js&quot;&gt;&lt;/script&gt;
        &lt;script&gt;
                var map = L.map(&#39;map&#39;);

        map.setView([39.4652, -0.3861], 13);

        L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
            attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
        }).addTo(map);
        &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</li>
<li><p class="first">Abrir el archivo index.html en el navegador para confirmar que se carga un mapa centrado en Valencia.</p>
</li>
<li><p class="first">Crear un archivo con el nombre de <em>package.json</em> dentro de la carpeta.</p>
</li>
<li><dl class="first docutils">
<dt>Abrir el archivo package.json con un editor de texto y copiar el siguiente código. ::</dt>
<dd><dl class="first docutils">
<dt>{</dt>
<dd><p class="first">&#8220;name&#8221;: &#8220;visor-gtfs&#8221;,
&#8220;version&#8221;: &#8220;1.0.0&#8221;,
&#8220;description&#8221;: &#8220;&#8221;,
&#8220;main&#8221;: &#8220;index.js&#8221;,
&#8220;scripts&#8221;: {</p>
<blockquote>
<div><p>&#8220;test&#8221;: &#8220;echo &#8220;Error: no test specified&#8221; &amp;&amp; exit 1&#8221;</p>
</div></blockquote>
<p>},
&#8220;author&#8221;: &#8220;&#8221;,
&#8220;license&#8221;: &#8220;ISC&#8221;,
&#8220;dependencies&#8221;: {</p>
<blockquote>
<div><p>&#8220;assert&#8221;: &#8220;^1.4.1&#8221;,
&#8220;express&#8221;: &#8220;^4.16.2&#8221;,
&#8220;fast-csv&#8221;: &#8220;^2.4.1&#8221;,
&#8220;request&#8221;: &#8220;^2.83.0&#8221;,
&#8220;yauzl&#8221;: &#8220;^2.9.1&#8221;</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</li>
<li><p class="first">Instalar Node.js <a class="footnote-reference" href="#id11" id="id4">[4]</a>. Descargar la última versión LTS (en este momento es la 8.9.1 LTS) y lo instalaremos con las opciones por defecto. Abrir la consola para verificar que se ha instalado correctamente y escribir</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">node</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
</li>
<li><p class="first">Navegar hasta nuestra carpeta <em>visor-gtfs</em> y escribir:</p>
<div class="highlight-python"><div class="highlight"><pre>npm install

Con este comando estamos instalando las dependencias declarades en el archivo *package.json*

Al ejecutar estos comandos veremos que se crea una carpeta llamada *node_modules* donde se guardan los módulos instalados.
</pre></div>
</div>
</li>
<li><p class="first">Crear un archivo llamado <em>app.js</em> que servirá de proxy con el servicio GTFS. Copiar lo siguiente en este archivo.</p>
<div class="highlight-python"><div class="highlight"><pre>var express  = require(&#39;express&#39;);
var app      = express();
var request = require(&#39;request&#39;);
var path = require(&#39;path&#39;);
var https = require(&#39;https&#39;);
var fs = require(&#39;fs&#39;);
var yauzl = require(&quot;yauzl&quot;);

app.get(&#39;/&#39;, function(req, res){
        res.sendFile(__dirname + &#39;/index.html&#39;);
});

app.listen(3000);
</pre></div>
</div>
</li>
<li><p class="first">Probar que nuestro proxy está funcionando, escribir:</p>
<div class="highlight-python"><div class="highlight"><pre>node app.js
</pre></div>
</div>
</li>
<li><p class="first">Escribir en el navegador <a class="reference external" href="http://localhost:3000">http://localhost:3000</a> y ver nuestro mapa.</p>
</li>
<li><p class="first">Crear un archivo llamado <em>gtfs2geojson.js</em>. Copiar en el archivo el código del siguiente enlace <a class="reference external" href="https://raw.githubusercontent.com/andrewharvey/gtfs2geojson/master/index.js">https://raw.githubusercontent.com/andrewharvey/gtfs2geojson/master/index.js</a> este código convierte datos de un GTFS en un GeoJSON. Código basado en la librería <a class="reference external" href="https://github.com/andrewharvey/gtfs2geojson">https://github.com/andrewharvey/gtfs2geojson</a></p>
</li>
<li><p class="first">Cargar en archivo en nuestra app.js. Escribir lo siguiente justo despúes de donde se carga el módulo yauzl</p>
<div class="highlight-python"><div class="highlight"><pre>var gtfs2geojson = require(&#39;./gtfs2geojson.js&#39;);
</pre></div>
</div>
</li>
<li><p class="first">Crear la variable que contiene la url del servicio GTFS de Líneas, paradas, horarios de autobuses de la EMT de Valencia <a class="footnote-reference" href="#id12" id="id5">[5]</a>. Escribir lo siguiente justo despues de la variable <em>gtfs2geojson</em></p>
<div class="highlight-python"><div class="highlight"><pre>const url = &#39;https://opendata.vlci.valencia.es:8443/dataset/4645f8bf-28d7-4420-bab2-d5c5e7de2a5a/resource/11591648-a984-4d64-89e3-3730f3123403/download/googletransit.zip&#39;;
</pre></div>
</div>
</li>
<li><p class="first">Crear una función llamada getZip para descargar un archivo. La función recibe como parámetro una url. Escribir lo siguiente al final del archivo app.js</p>
<div class="highlight-python"><div class="highlight"><pre>function getZip(url){
        return new Promise(function (resolve, reject) {
                var file = fs.createWriteStream(&quot;gtfs.zip&quot;);
                var request = https.get(url, function(response) {
                        response.pipe(file);
                });
                file.on(&#39;finish&#39;, function(){
                        resolve();
                });
        });
}
</pre></div>
</div>
</li>
<li><p class="first">Crear una función que extrae un archivo de un zip. La funcion recibe como parámetro el nombre del archivo que se desea extraer. Escribir lo siguiente al final del archivo app.js</p>
<div class="highlight-python"><div class="highlight"><pre>function leerZip(archivo){
        return new Promise(function (resolve, reject) {
                yauzl.open(&#39;gtfs.zip&#39;, {lazyEntries: true}, function(err, zipfile) {
                  if (err) throw err;
                  zipfile.readEntry();
                  zipfile.on(&quot;entry&quot;, function(entry) {
                    if (/\/$/.test(entry.fileName)) {
                      // Directory file names end with &#39;/&#39;.
                      // Note that entires for directories themselves are optional.
                      // An entry&#39;s fileName implicitly requires its parent directories to exist.
                      zipfile.readEntry();
                    } else {
                      // file entry
                      if(entry.fileName === archivo){
                        zipfile.openReadStream(entry, function(err, readStream) {
                                    if (err) throw err;
                                    var file = fs.createWriteStream(entry.fileName);
                                    readStream.pipe(file);
                                    file.on(&#39;finish&#39;, function(){
                                                resolve();
                                        });
                                });
                      }else{
                        zipfile.readEntry();
                      }
                    }
                  });
                });
        });
}
</pre></div>
</div>
</li>
<li><p class="first">Descargar el archivo GTFS y guardarlo en el ordenador. Escribir lo siguiente justo antes de la línea donde definimos el puerto por el cual escucha nuestro servidor</p>
<div class="highlight-python"><div class="highlight"><pre>app.all(&quot;/getdata/*&quot;, function(req, res) {
    getZip(url).then(function(){
                Promise.all([leerZip(&#39;shapes.txt&#39;),leerZip(&#39;stops.txt&#39;)]).then(values =&gt; {
                        res.json({&quot;msg&quot;: &quot;archivos descargados&quot;});
                });
        });
});
</pre></div>
</div>
</li>
<li><p class="first">Reiniciar nuestro servidor de node, ir a la consola y presionar Crtl+c. Escribir node app.js.</p>
</li>
<li><p class="first">Abrir la url <a class="reference external" href="http://localhost:3000/getdata/">http://localhost:3000/getdata/</a> en el navegador para comprobar que se han descargado correctamente los archivos <em>gtfs.zip</em>, <em>shapes.txt</em> y <em>stops.txt</em>.</p>
</li>
<li><p class="first">Leer los archivos GTFS y convertirlos a GeoJson. Escribir lo siguiente justo antes de la línea donde definimos el puerto por el cual escucha nuestro servidor</p>
<div class="highlight-python"><div class="highlight"><pre>app.all(&quot;/stops/*&quot;, function(req, res) {
    gtfs2geojson.stops(fs.readFileSync(&#39;stops.txt&#39;, &#39;utf8&#39;), function(result){
                res.json(result);
        });
});

app.all(&quot;/shapes/*&quot;, function(req, res) {
    gtfs2geojson.lines(fs.readFileSync(&#39;shapes.txt&#39;, &#39;utf8&#39;), function(result){
                res.json(result);
        });
});
</pre></div>
</div>
</li>
<li><p class="first">Reiniciar nuestro servidor de node, ir a la consola y presionar Crtl+c. Escribir node app.js.</p>
</li>
<li><p class="first">Abrir la url <a class="reference external" href="http://localhost:3000/stops/">http://localhost:3000/stops/</a> en el navegador para comprobar que se muestra un GeoJson con la información de las paradas.</p>
</li>
<li><p class="first">Cargar este JSON en nuestro mapa utilizando un plugin de Leaflet llamado <em>leaflet-ajax</em> <a class="footnote-reference" href="#id13" id="id6">[6]</a>. Este plugin permite hacer una llamada AJAX a un servicio que retorne un JSON y cargar la respuesta en un mapa. Para cargar este plugin debemos agregar lo siguiente justo después de donde hemos cargado el leaflet</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script src=&quot;https://calvinmetcalf.github.io/leaflet-ajax/dist/leaflet.ajax.js&quot;&gt;&lt;/script&gt;
</pre></div>
</div>
</li>
<li><p class="first">Utilizar el plugin para agregar la capa de paradas al mapa llamando a nuestro servidor. Agregar lo siguiente al final de nuestro código:</p>
<div class="highlight-python"><div class="highlight"><pre>        var geojsonParadas = new L.GeoJSON.AJAX(&#39;/stops/&#39;,{
    pointToLayer: function (feature, latlng) {
        return new L.CircleMarker(latlng, {
            radius: 5,
            fillColor: &quot;#A30000&quot;,
            color: &quot;#A30000&quot;,
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        });
    },
    onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.stop_name);
    }
}).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Recargar el mapa y comprobar que aparecen los puntos de las paradas en el mapa.</p>
</li>
<li><p class="first">Utilizar el plugin para agregar la capa de líneas al mapa llamando a nuestro servidor. Agregar lo siguiente al final de nuestro código:</p>
<div class="highlight-python"><div class="highlight"><pre>        var geojsonLineas = new L.GeoJSON.AJAX(&#39;/shapes/&#39;,{

}).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Recargar el mapa y comprobar que aparecen las líneas del bus en el mapa.</p>
</li>
<li><p class="first">Cargar la librería de manipulación de colores <strong>chroma.js</strong> <a class="footnote-reference" href="#id14" id="id7">[7]</a>. Escribir lo siguiente después de donde cargarmos el plugin de leaflet.ajax</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.5/chroma.min.js&quot;&gt;&lt;/script&gt;
</pre></div>
</div>
</li>
<li><p class="first">Dar estilo a la capa de líneas generando un color aleatorio. Escribir lo siguiente en las opciones de la capa geojsonLineas</p>
<div class="highlight-python"><div class="highlight"><pre>        style: function(geoJsonFeature){
    return {color: chroma.random(), opacity: 0.5};
}
</pre></div>
</div>
</li>
<li><p class="first">Recargar el mapa y comprobar que aparecen las líneas del bus en el mapa con colores aleatorios.</p>
</li>
</ol>
<div class="section" id="referencias">
<h3>Referencias<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h3>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://developers.google.com/transit/gtfs/?hl=es-419">https://developers.google.com/transit/gtfs/?hl=es-419</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://leafletjs.com/">http://leafletjs.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://opendata.vlci.valencia.es">https://opendata.vlci.valencia.es</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://nodejs.org/es/">https://nodejs.org/es/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="http://gobiernoabierto.valencia.es/es/dataset/?id=google-transit-lineas-paradas-horarios-de-autobuses">http://gobiernoabierto.valencia.es/es/dataset/?id=google-transit-lineas-paradas-horarios-de-autobuses</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="https://github.com/calvinmetcalf/leaflet-ajax">https://github.com/calvinmetcalf/leaflet-ajax</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td><a class="reference external" href="https://github.com/gka/chroma.js/">https://github.com/gka/chroma.js/</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>