<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ejemplo Geoservicio realtime &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
    <link rel="next" title="Utilización de servicios de sensores" href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html" />
    <link rel="prev" title="Ejemplo Mapzen Mobility" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html">Introducción a las Smart Cities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html">Conceptos básicos de Geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html#geoservicio">Geoservicio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html">Conceptos sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html">Conceptos Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html">Utilización de servicios Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplo-api-ckan">Ejemplo API CKAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplos-api-socrata">Ejemplos API SOCRATA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html">Servicios realtime Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#algunos-problemas-que-nos-encontraremos-al-trabar-con-servicios-open-data">Algunos problemas que nos encontraremos al trabar con servicios Open Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-no-tan-buenas-practicas">Ejemplo de no tan buenas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html">Herramientas de visualización Opendata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html">Ejemplo servicio bicing Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#acceso-al-servicio-de-datos-del-bicing-de-barcelona">Acceso al servicio de datos del Bicing de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#creacion-de-un-visor">Creación de un visor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html">Servicios realtime sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#algunos-problemas-que-nos-encontraremos-al-trabar-con-sensores">Algunos problemas que nos encontraremos al trabar con sensores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-no-tan-buenas-practicas">Ejemplo de no tan buenas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html">Ejemplo sensores port Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona">Acceso al servicio de datos de sensores del Port de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#creacion-de-un-visor">Creación de un visor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html">Ejemplo Sentilo ACA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#acceso-al-servicios-de-sensores-sentilo-de-la-aca">Acceso al servicios de sensores Sentilo de la ACA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#creacion-de-un-visor">Creación de un visor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html">Geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#id1">Geoservicios realtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#geocodificacion">Geocodificación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#routing">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#servicios-varios">Servicios varios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html">Herramientas de visualización geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html">Ejemplo Mapzen Mobility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html#acceso-a-los-servicios-de-mapzen-mobility">Acceso a los servicios de Mapzen Mobility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html#creacion-de-un-visor-que-permita-el-caculo-de-isocronas">Creación de un visor que permita el cáculo de Isócronas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html#agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa">Agregar un buscador de direcciones y puntos de interés al mapa</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Ejemplo Geoservicio realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creacion-de-un-servicio-realtime-para-compartir-la-ubicacion">Creación de un servicio realtime para compartir la ubicación</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creacion-del-mapa">Creación del mapa</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios">Creación del servicio que comparte la ubicación de los usuarios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html">Utilización de servicios de sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html">Utilización de geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html">¿Cómo crear un geoservicio?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html#apartado">Apartado</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Ejemplo Geoservicio realtime</a><ul>
<li><a class="reference internal" href="#creacion-de-un-servicio-realtime-para-compartir-la-ubicacion">Creación de un servicio realtime para compartir la ubicación</a></li>
<li><a class="reference internal" href="#creacion-del-mapa">Creación del mapa</a></li>
<li><a class="reference internal" href="#creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios">Creación del servicio que comparte la ubicación de los usuarios</a><ul>
<li><a class="reference internal" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html" title="Previous Chapter: Ejemplo Mapzen Mobility"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Ejemplo Mapze...</span>
    </a>
  </li>
  <li>
    <a href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html" title="Next Chapter: Utilización de servicios de sensores"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Utilización d... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="ejemplo-geoservicio-realtime">
<h1>Ejemplo Geoservicio realtime<a class="headerlink" href="#ejemplo-geoservicio-realtime" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8 Noviembre 2017</td>
<td><ul class="first last simple">
<li>Wladimir Szczerban</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2017 Wladimir Szczerban</p>
</div></blockquote>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia: Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="creacion-de-un-servicio-realtime-para-compartir-la-ubicacion">
<h2>Creación de un servicio realtime para compartir la ubicación<a class="headerlink" href="#creacion-de-un-servicio-realtime-para-compartir-la-ubicacion" title="Permalink to this headline">¶</a></h2>
<p>Crearemos un servicio que permita compartir la ubicación de los usuarios y ver que usuarios están en linea. Para ello utilizaremos la librería Socket.io <a class="footnote-reference" href="#id7" id="id1">[1]</a> que permite la comunicación en tiempo real en dos direcciones cliente-servidor (tipo pull) y servidor-cliente (tipo push). Esto lo hace gracias a un socket <a class="footnote-reference" href="#id8" id="id2">[2]</a> .</p>
<p>Para mostrar los datos en el mapa utilizaremos la libreria Leaflet <a class="footnote-reference" href="#id9" id="id3">[3]</a> . Para obtener la ubicación de los usuarios podemos usar el plugin <em>leaflet-locatecontrol</em> <a class="footnote-reference" href="#id10" id="id4">[4]</a> en nuestro caso vamos en lugar de utilizar la ubicación del usuario vamos a simular la ubicación del usuario haciendo click sobre el mapa.</p>
</div>
<div class="section" id="creacion-del-mapa">
<h2>Creación del mapa<a class="headerlink" href="#creacion-del-mapa" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">En nuestro ordenador creamos una carpeta con el nombre de <em>user-realtime</em>.</p>
</li>
<li><p class="first">Dentro de esta carpeta creamos un archivo con el nombre de <em>index.html</em>.</p>
</li>
<li><p class="first">Abrimos el archivo index.html con un editor de texto y copiamos el siguiente código.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
        &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.css&quot; /&gt;
    &lt;style&gt;
        #map {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
        &lt;div id=&quot;map&quot;&gt;&lt;/div&gt;

    &lt;script src=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        var map = L.map(&#39;map&#39;);

        map.setView([41.3887, 2.1777], 13);


                L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
                    attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
                }).addTo(map);

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</li>
<li><p class="first">Abrimos el archivo index.html en el navegador y vemos que se nos carga un mapa centrado en Barcelona.</p>
</li>
<li><p class="first">Capturamos el click en el mapa. Para esto tenemos que capturar el evento click. Luego de la declaración de nuestra capa vamos a escribir los siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>    map.on(&#39;click&#39;, function(e){
console.log(e);
    });
</pre></div>
</div>
</li>
<li><p class="first">Recargamos la aplicación y abrimos la consola del desarrollador, al hacer click sobre el mapa, en la consola aparece el objeto del evento click. Si inspeccionamos este objeto vemos que tiene una propiedad llamada latlng que contine las coordenadas donde se ha hecho el click.</p>
</li>
</ol>
</div>
<div class="section" id="creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios">
<h2>Creación del servicio que comparte la ubicación de los usuarios<a class="headerlink" href="#creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios" title="Permalink to this headline">¶</a></h2>
<p>Para la creación del servicio utilizaremos Nodejs <a class="footnote-reference" href="#id11" id="id5">[5]</a> para implementar nuestro servidor web y utilizaremos el módulo de socket.io para establecer la comunicación entre el cliente y nuestro servidor.</p>
<ol class="arabic">
<li><p class="first">Instalación de Node. Nos descargamos la última versión LTS (en este momento es la 8.9.1 LTS) y lo instalamos con las opciones por defecto. Una vez instalado el Node abrimos la consola para verificar que se ha instalado correctamente escribimos</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">node</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
</li>
<li><p class="first">En la consola navegamos hasta nuestra carpeta <em>user-realtime</em>. Con este comando estamos creando el archivo <em>package.json</em>. Este comando solicita varios elementos como, por ejemplo, el nombre y la versión de la aplicación. Por ahora, sólo hay que pulsar ENTER para aceptar los valores predeterminados. Una vez en la carpeta escribimos:</p>
<div class="highlight-python"><div class="highlight"><pre>npm init
</pre></div>
</div>
</li>
<li><p class="first">Instalar las dependencias para crear nuestro servicio de proxy. En este caso utilizaremos Express <a class="footnote-reference" href="#id12" id="id6">[6]</a> como servidor web y el módulo socket.io.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Instalar el express y guardarlo en la lista de dependencias</p>
<div class="highlight-python"><div class="highlight"><pre>npm install express --save
</pre></div>
</div>
</li>
<li><p class="first">Instalar el socket.io y guardarlo en la lista de dependencias</p>
<div class="highlight-python"><div class="highlight"><pre>npm install socket.io --save
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Al ejecutar estos comandos vemos que se nos crea una carpeta llamada <em>node_modules</em> que es donde se guardan los módulos que hemos instalado.</p>
</li>
<li><p class="first">En nuestra carpeta creamos un archivo llamado <em>app.js</em> que contendrá nuestra aplicación que servirá de proxy con el servicio de Bicing. Para ello copiremos lo siguiente en este archivo.</p>
<div class="highlight-python"><div class="highlight"><pre>var express  = require(&#39;express&#39;);
var app = express();
var http = require(&#39;http&#39;).Server(app);
var io = require(&#39;socket.io&#39;)(http);

app.get(&#39;/&#39;, function(req, res){
        res.sendFile(__dirname + &#39;/index.html&#39;);
});

io.on(&#39;connection&#39;, function(socket){
        console.log(&#39;a user connected&#39;);
});

http.listen(3000, function(){
  console.log(&#39;listening on *:3000&#39;);
});
</pre></div>
</div>
</li>
<li><p class="first">Para probar que nuestro proxy está funcionando vamos a la consola y escribimos:</p>
<div class="highlight-python"><div class="highlight"><pre>node app.js
</pre></div>
</div>
</li>
<li><p class="first">Abrimos la url de nuestro proxy <a class="reference external" href="http://localhost:3000/">http://localhost:3000/</a> en el navegador y vemos nuestro mapa.</p>
</li>
<li><p class="first">En nuestro archivo html agregamos la librería cliente de socket.io. Justo debajo de donde cargamos el leaflet escribimos</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js&quot;&gt;&lt;/script&gt;
</pre></div>
</div>
</li>
<li><p class="first">Al inicio de nuestro código antes de la declaración del mapa declaramos nuestra variable que va a tener el objeto socket.io. Para ello escribimos los siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>var socket = io();
</pre></div>
</div>
</li>
<li><p class="first">Ahora recarmos la página y podemos ver en la consola que nos aparece el mensaje de <em>a user connected</em>.</p>
</li>
<li><p class="first">En la funcion que se llama al hacer click sobre el mapa enviaremos un evento al servidor, este evento lo llamaremos <em>user_click</em>. A este evento le pasaremos como parámetro la posición del click. Para ello copiamos lo siguiente en la función del on click.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">socket</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">latlng</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">En nuestra aplicación del servidor tenemos que escuchar al evento <em>user_click</em>. Dentro de la función que se llama en el <em>io.on</em> es donde se crea el socket de conexión, por lo tando escribiremos nuestro código dentro de la misma. Debajo de donde escribimos el mensaje de <em>a user connected</em> escribimos lo siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>socket.on(&#39;user_click&#39;, function(msg){
        console.log(msg);
});
</pre></div>
</div>
</li>
<li><p class="first">Para reiniciar nuestro servidor de node vamos a la consola y presionamos Crtl+c. Luego volvemos a escribir node app.js.</p>
</li>
<li><p class="first">Ahora recargamos la página y si hacemos click sobre el mapa vemos en la consola que nos aparecen las coordenadas del click. Con esto ya hemos logrado la comunicación cliente-servidor.</p>
</li>
<li><p class="first">Para lograr la comunicación servidor-cliente y que el servidor notifique a todos los cliente debemos emitir un evento en nuestro servidor. Este evento lo llamaremos <em>new_user</em>. Para emitir el evento dentro de la función que se llama en el evento <em>user_click</em> copiamos los siguiente.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">io</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;new_user&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">En nuestro cliente ahora debemos escuchar el evento <em>new_user</em>. Al final de nuestro código del html escribimos</p>
<div class="highlight-python"><div class="highlight"><pre>        socket.on(&#39;new_user&#39;, function(msg){
        console.log(msg);
});
</pre></div>
</div>
</li>
<li><p class="first">Volvemos a recargar el servidor y recargamos la página. Ahora al clicar sobre el mapa vemos las coordenadas del click tanto en el la consola del servidor como en la consola de desarrolladores del navegador.</p>
</li>
<li><p class="first">Vamos a mostrar un marcador en el mapa en la posición donde el usuario hace click. En nuestro html en la función que escucha el evento <em>new_user</em> agregamos el siguiente código</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">marker</span><span class="p">([</span><span class="n">msg</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">lng</span><span class="p">])</span><span class="o">.</span><span class="n">addTo</span><span class="p">(</span><span class="nb">map</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Recargamos nuestra aplicación y abrimos otra pestaña con nuestra aplicación para simular que somos dos usuarios distintos. Si hacemos click en nuestro mapa en cualquiera de las pestañas vemos que nos aparece el marcador en ambas pestañas.</p>
</li>
</ol>
<div class="section" id="referencias">
<h3>Referencias<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h3>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://socket.io/">https://socket.io/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://es.wikipedia.org/wiki/Socket_de_Internet">https://es.wikipedia.org/wiki/Socket_de_Internet</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="http://leafletjs.com/">http://leafletjs.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://github.com/domoritz/leaflet-locatecontrol">https://github.com/domoritz/leaflet-locatecontrol</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="https://nodejs.org/es/">https://nodejs.org/es/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="http://expressjs.com/">http://expressjs.com/</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>