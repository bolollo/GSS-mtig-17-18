<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ejemplo servicio bicing Barcelona &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
    <link rel="next" title="Servicios realtime sensores" href="../servicios-realtime-sensores/servicios-realtime-sensores.html" />
    <link rel="prev" title="Herramientas de visualización Opendata" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html">Introducción a las Smart Cities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html">Conceptos básicos de Geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html#geoservicio">Geoservicio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html">Conceptos sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html">Conceptos Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html">Utilización de servicios Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplo-api-ckan">Ejemplo API CKAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplos-api-socrata">Ejemplos API SOCRATA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html">Servicios realtime Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#problemas-frecuentes-al-trabajar-con-servicios-open-data">Problemas frecuentes al trabajar con servicios Open Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-malas-practicas">Ejemplo de malas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html">Herramientas de visualización Opendata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Ejemplo servicio bicing Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#acceso-al-servicio-de-datos-del-bicing-de-barcelona">Acceso al servicio de datos del Bicing de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creacion-de-un-visor">Creación de un visor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creacion-del-proxy">Creación del proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html">Servicios realtime sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#problemas-frecuentes-al-trabajar-con-sensores">Problemas frecuentes al trabajar con sensores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-malas-practicas">Ejemplo de malas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html">Ejemplo sensores port Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona">Acceso al servicio de datos de sensores del Port de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#creacion-de-un-visor">Creación de un visor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html">Ejemplo Sentilo ACA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#acceso-al-servicios-de-sensores-sentilo-de-la-aca">Acceso al servicios de sensores Sentilo de la ACA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#creacion-de-un-visor">Creación de un visor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html">Geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#id1">Geoservicios realtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#geocodificacion">Geocodificación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#routing">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#servicios-varios">Servicios varios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html">Herramientas de visualización geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html">Ejemplo Mapzen Mobility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html#acceso-a-los-servicios-de-mapzen-mobility">Acceso a los servicios de Mapzen Mobility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html#creacion-de-un-visor-que-permita-el-caculo-de-isocronas">Creación de un visor que permita el cáculo de Isócronas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.html#agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa">Agregar un buscador de direcciones y puntos de interés al mapa</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html">Ejemplo Geoservicio realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#creacion-de-un-servicio-realtime-para-compartir-la-ubicacion">Creación de un servicio realtime para compartir la ubicación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#creacion-del-mapa">Creación del mapa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios">Creación del servicio que comparte la ubicación de los usuarios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html">Utilización de servicios de sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html">Utilización de geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html">¿Cómo crear un geoservicio?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html#apartado">Apartado</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Ejemplo servicio bicing Barcelona</a><ul>
<li><a class="reference internal" href="#acceso-al-servicio-de-datos-del-bicing-de-barcelona">Acceso al servicio de datos del Bicing de Barcelona</a></li>
<li><a class="reference internal" href="#creacion-de-un-visor">Creación de un visor</a></li>
<li><a class="reference internal" href="#creacion-del-proxy">Creación del proxy</a><ul>
<li><a class="reference internal" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html" title="Previous Chapter: Herramientas de visualización Opendata"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Herramientas ...</span>
    </a>
  </li>
  <li>
    <a href="../servicios-realtime-sensores/servicios-realtime-sensores.html" title="Next Chapter: Servicios realtime sensores"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Servicios rea... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="ejemplo-servicio-bicing-barcelona">
<h1>Ejemplo servicio bicing Barcelona<a class="headerlink" href="#ejemplo-servicio-bicing-barcelona" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8 Noviembre 2017</td>
<td><ul class="first last simple">
<li>Wladimir Szczerban</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2017 Wladimir Szczerban</p>
</div></blockquote>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia: Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="acceso-al-servicio-de-datos-del-bicing-de-barcelona">
<h2>Acceso al servicio de datos del Bicing de Barcelona<a class="headerlink" href="#acceso-al-servicio-de-datos-del-bicing-de-barcelona" title="Permalink to this headline">¶</a></h2>
<p>En el portal Open data del Ayuntamiento de Barcelona podemos encontrar un dataset (conjunto de datos) que contiene las <a class="reference external" href="http://opendata-ajuntament.barcelona.cat/data/es/dataset/bicing">estaciones del servicio de Bicing</a></p>
<p>Si bien el Ayuntamiento de Barcelona no ofrece explicitamente el acceso a los datos del Bicing como un servicio, si que tiene un servicio de datos en tiempo real. La url la podemos encontrar presionando el botón de Descargar del recurso bicing.json</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="capturar url servicio de bicing" class="align-middle" src="../_images/bicing.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Al abrir la url <a class="reference external" href="http://wservice.viabicing.cat/v2/stations">http://wservice.viabicing.cat/v2/stations</a> en nuestro navegador observaremos que la respuesta es un archivo json con un conjunto de elementos que tienen las coordenadas de la localización de la estación de bicing, la disponibilidad de bicis, las estaciones más cercanas, etc.</p>
<p>Mapa que utiliza este servicio, <a class="reference external" href="https://www.instamaps.cat/instavisor/1611695/dc769e48513f5df888691d2048005934/Estacions_bicing_i_carrils_bici_a_BCN_.html?3D=false#14/41.3962/2.1714">Ejemplo creado en la plataforma Instamaps</a></p>
<p>El archivo json que retorna el servicio tiene coordenadas pero no es un fichero GeoJSON <a class="footnote-reference" href="#id9" id="id1">[1]</a>.</p>
<p>Para ver estos datos sobre un mapa crearemos un visor utilizando Leaflet <a class="footnote-reference" href="#id10" id="id2">[2]</a>.</p>
</div>
<div class="section" id="creacion-de-un-visor">
<h2>Creación de un visor<a class="headerlink" href="#creacion-de-un-visor" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Crer una carpeta con el nombre de <em>visor-bicing</em>.</p>
</li>
<li><p class="first">Crear un archivo con el nombre de <em>index.html</em> dentro de la carpeta</p>
</li>
<li><p class="first">Abrir el archivo index.html con un editor de texto y copiar el siguiente código.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
        &lt;title&gt;Servicio de Bicing realtime&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.css&quot; /&gt;
    &lt;style&gt;
        #map {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
        &lt;div id=&quot;map&quot;&gt;&lt;/div&gt;

    &lt;script src=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        var map = L.map(&#39;map&#39;);

        map.setView([41.3887, 2.1777], 13);


                L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
                    attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
                }).addTo(map);

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</li>
<li><p class="first">Abrir el archivo index.html en el navegador para ver que carga un mapa centrado en Barcelona.</p>
</li>
<li><p class="first">Agregar el plugin para cargar datos en tiempo real. Para ellos utilizaremos el plugin Leaflet Realtime <a class="footnote-reference" href="#id11" id="id3">[3]</a>.  Copiar lo siguiente justo después de cuando carguemos la libreria de Leaflet.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet-realtime/2.1.0/leaflet-realtime.min.js&quot;&gt;&lt;/script&gt;
</pre></div>
</div>
</li>
<li><p class="first">Agregar la capa de realtime del bicing a nuestro mapa. Siguiendo el ejemplo básico del plugin para cagar una capa, copiar lo siguiente al final de nuestro código de javascript.</p>
<div class="highlight-python"><div class="highlight"><pre>    var realtime = L.realtime({
    url: &#39;http://wservice.viabicing.cat/v2/stations&#39;,
    crossOrigin: true,
    type: &#39;json&#39;
}, {
    interval: 3 * 1000
}).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Recargar la página para visualizar nuestra capa de bicing. Observaremos que no aparece ningún dato, esto es debido a que estamos llamando a un servicio que no está en nuestro dominio y nos da un error de CORS <a class="footnote-reference" href="#id12" id="id4">[4]</a>. Abrir la consola de desarrollador del navegador presionando F12 y veremos que cada 3 segundos aparecerá un error. Para evitar el error de CORS necesitamos un proxy <a class="footnote-reference" href="#id13" id="id5">[5]</a> en nuestro servidor web que pueda hacer la llamada al servicio de bicing y que nos devuelva el contenido.</p>
</li>
</ol>
</div>
<div class="section" id="creacion-del-proxy">
<h2>Creación del proxy<a class="headerlink" href="#creacion-del-proxy" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Instalar Node.js <a class="footnote-reference" href="#id14" id="id6">[6]</a>. Descargar la última versión LTS (en este momento es la 8.9.1 LTS) y lo instalaremos con las opciones por defecto. Una vez instalado el Node abrir la consola para verificar que se ha instalado correctamente. Escribir</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">node</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
</li>
<li><p class="first">Navegar hasta nuestra carpeta <em>visor-bicing</em> y escribir:</p>
<div class="highlight-python"><div class="highlight"><pre>npm init

Con este comando estaremos creando el archivo *package.json*. Este comando solicita varios elementos como, por ejemplo, el nombre y la versión de la aplicación. Por ahora, sólo hay que pulsar ENTER para aceptar los valores predeterminados.
</pre></div>
</div>
</li>
<li><p class="first">Instalar las dependencias para crear nuestro servicio de proxy. En este caso utilizaremos Express <a class="footnote-reference" href="#id15" id="id7">[7]</a> como servidor web y el módulo http-proxy <a class="footnote-reference" href="#id16" id="id8">[8]</a> .</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Instalar el express y guardarlo en la lista de dependencias</p>
<div class="highlight-python"><div class="highlight"><pre>npm install express --save
</pre></div>
</div>
</li>
<li><p class="first">Instalar el http-proxy y guardarlo en la lista de dependencias</p>
<div class="highlight-python"><div class="highlight"><pre>npm install http-proxy --save
</pre></div>
</div>
</li>
</ol>
<p>Al ejecutar estos comandos veremos que se crea una carpeta llamada <em>node_modules</em> donde se guardan los módulos instalados.</p>
</div></blockquote>
</li>
<li><p class="first">Crear un archivo llamado <em>app.js</em> que servirá de proxy con el servicio de Bicing. Copiar lo siguiente en este archivo.</p>
<div class="highlight-python"><div class="highlight"><pre>var express  = require(&#39;express&#39;);
var app      = express();
var httpProxy = require(&#39;http-proxy&#39;);
var apiProxy = httpProxy.createProxyServer();
var serverBicing = &#39;http://wservice.viabicing.cat/v2/stations&#39;;


app.use(express.static(&#39;public&#39;));

app.all(&quot;/bicing/*&quot;, function(req, res) {
    console.log(&#39;redirecting to Server1&#39;);
    apiProxy.web(req, res, {
        target: serverBicing,
        changeOrigin: false,
        ignorePath: true
    });
});

app.listen(3000);
</pre></div>
</div>
</li>
<li><p class="first">Probar que nuestro proxy está funcionando, escribiendo:</p>
<div class="highlight-python"><div class="highlight"><pre>node app.js
</pre></div>
</div>
</li>
<li><p class="first">Abrir la url de nuestro proxy <a class="reference external" href="http://localhost:3000/bicing/">http://localhost:3000/bicing/</a> en el navegador.</p>
</li>
<li><p class="first">Crear una carpeta llamada <em>public</em> dentro de nuestra carpeta y mover el archivo index.html dentro de esa carpeta. Con esto ya podemos ver nuestra aplicación del mapa servida desde un servidor web y no abriendola directamente como habíamos hecho hasta ahora.</p>
</li>
<li><p class="first">Escribir en el navegador <a class="reference external" href="http://localhost:3000">http://localhost:3000</a> para ver nuestro mapa.</p>
</li>
<li><p class="first">Modificar el archivo index.html para que llame al proxy que hemos creado. Cambiar la url del servicio de bicing <em>http://wservice.viabicing.cat/v2/stations</em> por nuestro proxy <em>http://localhost:3000/bicing/</em> (como el proxy y la aplicación están en el mismo servidor podríamos usar <em>/bicing/</em>). Recargar la aplicación con Ctrl+F5 y veremos que el error que nos da ahora es diferente.</p>
<blockquote>
<div><p>En este caso el error es <em>Error: Invalid GeoJSON object.</em>. Este error es debido a lo que ya comentamos; la respuesta del servicio de Bicing no es un GeoJSON.</p>
</div></blockquote>
</li>
<li><p class="first">Crear una variable llamada geojson que será la que contendrá el GeoJSON resultante de la transformación, antes de la declaración de nuestra capa de realtime</p>
<div class="highlight-python"><div class="highlight"><pre>        var geojson = {
    type: &#39;FeatureCollection&#39;,
    features: []
};
</pre></div>
</div>
</li>
<li><p class="first">Modificar la aplicación para transformar la respuesta del bicing en un GeoJSON. Modificar nuestra capa realtime con el siguiente código</p>
<div class="highlight-python"><div class="highlight"><pre>    var realtime = L.realtime(function(success, error) {
    fetch(&#39;/bicing/&#39;)
    .then(function(response) {
            return response.json();
    })
    .then(function(data) {
            var stations = data.stations;
            for (var i = stations.length - 1; i &gt;= 0; i--) {
                    var station = stations[i];
                    var feature = {
                            type: &#39;Feature&#39;,
                            properties: {
                                altitude: station.altitude,
                                bikes: station.bikes,
                                id: station.id,
                                nearbyStations: station.nearbyStations,
                                slots: station.slots,
                                status: station.status,
                                streetName: station.streetName,
                                streetNumber: station.streetNumber,
                                type: station.type
                            },
                            geometry: {
                                type: &#39;Point&#39;,
                                coordinates: [station.longitude, station.latitude]
                            }
                        };
                        geojson.features.push(feature);
            }
        success(geojson);
    })
    .catch(error);
}, {
    interval: 3 * 1000
}).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Recargar la aplicación y veremos los puntos de las estaciones de bicing. Si vamos a la pestaña de red (network) en la consola de desarrollador del navegador podremos ver que cada 3 segundos se hace una llamada a nuetro proxy.</p>
</li>
<li><p class="first">Crear un popup para ver la información de la estación al seleccionarla. Escribir justo después de donde definimos el intervalo</p>
<div class="highlight-python"><div class="highlight"><pre>        ,onEachFeature(f, l) {
    l.bindPopup(function() {
        return &#39;&lt;h3&gt;&#39; + f.properties.id + &#39;&lt;/h3&gt;&#39; +
            &#39;&lt;p&gt;&#39; + f.properties.streetName +
            &#39;&lt;br/&gt;bike: &lt;strong&gt;&#39; + f.properties.bikes + &#39;&lt;/strong&gt;&lt;/p&gt;&#39; +
            &#39;&lt;p&gt;slots: &#39; + f.properties.slots + &#39;&lt;/p&gt;&#39;;
    });
}
</pre></div>
</div>
</li>
<li><p class="first">Recargar la página y hacer click sobre alguna estación para ver su información en tiempo real.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="mapa de servicio de bicing" class="align-middle" src="../_images/mapa_bicing.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ol>
<div class="section" id="referencias">
<h3>Referencias<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h3>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://es.wikipedia.org/wiki/GeoJSON">https://es.wikipedia.org/wiki/GeoJSON</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://leafletjs.com/">http://leafletjs.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://github.com/perliedman/leaflet-realtime">https://github.com/perliedman/leaflet-realtime</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://developer.mozilla.org/es/docs/Web/HTTP/Access_control_CORS">https://developer.mozilla.org/es/docs/Web/HTTP/Access_control_CORS</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="https://es.wikipedia.org/wiki/Servidor_proxy">https://es.wikipedia.org/wiki/Servidor_proxy</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="https://nodejs.org/es/">https://nodejs.org/es/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td><a class="reference external" href="http://expressjs.com/">http://expressjs.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[8]</a></td><td><a class="reference external" href="https://github.com/nodejitsu/node-http-proxy">https://github.com/nodejitsu/node-http-proxy</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>