<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ejemplo Mapzen Mobility &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
    <link rel="next" title="Ejemplo Geoservicio realtime" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html" />
    <link rel="prev" title="Herramientas de visualización geoservicios" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html">Introducción a las Smart Cities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html">Conceptos básicos de Geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html#geoservicio">Geoservicio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html">Conceptos sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html">Conceptos Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html">Utilización de servicios Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplo-api-ckan">Ejemplo API CKAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html#ejemplos-api-socrata">Ejemplos API SOCRATA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html">Servicios realtime Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#problemas-frecuentes-al-trabajar-con-servicios-open-data">Problemas frecuentes al trabajar con servicios Open Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#ejemplo-de-malas-practicas">Ejemplo de malas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html">Herramientas de visualización Opendata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html">Ejemplo servicio bicing Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#acceso-al-servicio-de-datos-del-bicing-de-barcelona">Acceso al servicio de datos del Bicing de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#creacion-de-un-visor">Creación de un visor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#creacion-del-proxy">Creación del proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html">Servicios realtime sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#problemas-frecuentes-al-trabajar-con-sensores">Problemas frecuentes al trabajar con sensores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-buenas-practicas">Ejemplo de buenas prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#ejemplo-de-malas-practicas">Ejemplo de malas prácticas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html">Ejemplo sensores port Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona">Acceso al servicio de datos de sensores del Port de Barcelona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#creacion-de-un-visor">Creación de un visor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html">Ejemplo Sentilo ACA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#acceso-al-servicio-de-sensores-sentilo-de-la-aca">Acceso al servicio de sensores Sentilo de la ACA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#creacion-de-un-visor">Creación de un visor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#creacion-del-proxy">Creación del proxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html">Geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#id1">Geoservicios realtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#geocodificacion">Geocodificación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#routing">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#isocronas">Isócronas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#servicios-varios">Servicios varios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html">Herramientas de visualización geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Ejemplo Mapzen Mobility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nota">NOTA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html">Ejemplo Geoservicio realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#servicio-realtime-para-compartir-la-ubicacion">Servicio realtime para compartir la ubicación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#creacion-del-mapa">Creación del mapa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html#creacion-del-servicio-que-comparte-la-ubicacion-de-los-usuarios">Creación del servicio que comparte la ubicación de los usuarios</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Ejemplo Mapzen Mobility</a><ul>
<li><a class="reference internal" href="#nota">NOTA</a><ul>
<li><a class="reference internal" href="#acceso-a-los-servicios-de-mapzen-mobility">Acceso a los servicios de Mapzen Mobility</a></li>
<li><a class="reference internal" href="#creacion-de-un-visor-que-permita-el-caculo-de-isocronas">Creación de un visor que permita el cáculo de Isócronas</a></li>
<li><a class="reference internal" href="#agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa">Agregar un buscador de direcciones y puntos de interés al mapa</a></li>
<li><a class="reference internal" href="#una-alternativa-al-servicio-de-isocronas-de-mapzen">Una alternativa al servicio de Isócronas de Mapzen</a><ul>
<li><a class="reference internal" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html" title="Previous Chapter: Herramientas de visualización geoservicios"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Herramientas ...</span>
    </a>
  </li>
  <li>
    <a href="../ejemplo-geoservicio-realtime/ejemplo-geoservicio-realtime.html" title="Next Chapter: Ejemplo Geoservicio realtime"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Ejemplo Geose... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="ejemplo-mapzen-mobility">
<h1>Ejemplo Mapzen Mobility<a class="headerlink" href="#ejemplo-mapzen-mobility" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8 Noviembre 2017</td>
<td><ul class="first last simple">
<li>Wladimir Szczerban</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2017 Wladimir Szczerban</p>
</div></blockquote>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia: Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="nota">
<h2>NOTA<a class="headerlink" href="#nota" title="Permalink to this headline">¶</a></h2>
<p>Desafortunadamente Mapzen cierra operaciones a finales de Enero de 2018. Por lo tanto el servicio de Isócronas no estará disponible a partir del 1 Febrero de 2018. Podéis ver el anuncio del cierre aquí <a class="reference external" href="https://mapzen.com/blog/shutdown/">https://mapzen.com/blog/shutdown/</a></p>
<div class="section" id="acceso-a-los-servicios-de-mapzen-mobility">
<h3>Acceso a los servicios de Mapzen Mobility<a class="headerlink" href="#acceso-a-los-servicios-de-mapzen-mobility" title="Permalink to this headline">¶</a></h3>
<p>Mapzen Mobility <a class="footnote-reference" href="#id11" id="id1">[1]</a> es un kit de herramientas para el transporte multimodal, está basado en software libre y usa datos abiertos (principalmente datos de OpenStreetMap). Consta de varias herramientas, tales como:
- Mapzen Turn-by-Turn: servicio de navegación para el mundo, ya sea en automóvil, en bicicleta, a pie y combinaciones multimodales que combinen andar a pie y el uso del transporte público.
- Mapzen Matrix: servicio de cálculo de tabla de distancia y tiempo entre diferentes lugares.
- Mapzen Isochrone: servicio para obtener un cálculo de las áreas que se pueden alcanzar dentro de períodos de tiempo específicos desde una ubicación o un conjunto de ubicaciones.
- Mapzen Map Matching: servicio que permite convertir una ruta en una ruta con instrucciones narrativas. Esto lo hace observando las coordenadas que coinciden con las coordenadas de las carreteras conocidas y así obtiene los valores de los atributos de esa línea coincidente.</p>
<p>Otro servicio interesante de Mapzen es el servicio de búsqueda que permite geocodificar direcciones ó buscar puntos de interés. <a class="footnote-reference" href="#id12" id="id2">[2]</a></p>
<p>Mapzen tiene una librería Mapzen JavaScript SDK <a class="footnote-reference" href="#id13" id="id3">[3]</a> que está basada en Leaflet <a class="footnote-reference" href="#id14" id="id4">[4]</a> . Esta facilita el uso de los diferentes servicios de Mapzen. Aquí <a class="footnote-reference" href="#id15" id="id5">[5]</a> se puede ver un ejemplo del cálculo de Isócronas utilizando la librería js de Mapzen.</p>
<p>En nuestro caso crearemos un visor utilizando Leaflet y llamando directamente al servicio de Mapzen.</p>
</div>
<div class="section" id="creacion-de-un-visor-que-permita-el-caculo-de-isocronas">
<h3>Creación de un visor que permita el cáculo de Isócronas<a class="headerlink" href="#creacion-de-un-visor-que-permita-el-caculo-de-isocronas" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Crear una carpeta con el nombre de <em>visor-mobility</em>.</p>
</li>
<li><p class="first">Crear un archivo con el nombre de <em>index.html</em> dentro de la carpeta.</p>
</li>
<li><p class="first">Abrir el archivo index.html con un editor de texto y copiar el siguiente código.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
        &lt;title&gt;Ejemplo Isócronas Mapzen&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.css&quot; /&gt;
        &lt;style&gt;
        #map {
            height: 100%;
            width: 100%;
            position: absolute;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

        &lt;div id=&quot;map&quot;&gt;

    &lt;/div&gt;

        &lt;script src=&quot;https://unpkg.com/leaflet@1.2.0/dist/leaflet.js&quot;&gt;&lt;/script&gt;
        &lt;script&gt;
                var map = L.map(&#39;map&#39;);

        map.setView([41.3887, 2.1777], 13);

        L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
            attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
        }).addTo(map);
        &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</li>
<li><p class="first">Abrir el archivo index.html en el navegador para confirmar que se carga un mapa centrado en Barcelona.</p>
</li>
<li><p class="first">Crear una API key. Al revisar la documentación de la API del servicio de Mapzen Isochrone <a class="footnote-reference" href="#id16" id="id6">[6]</a> vemos que es necesario tener una API key para poder utilizarlo. Para crear la API key hay que darse de alta en la página de Mapzen <a class="footnote-reference" href="#id17" id="id7">[7]</a>, esta tiene una versión gratuita que tiene unas cuotas de uso. Si se quiere hacer un uso más intesivo del servicio hay que pagar.</p>
</li>
<li><p class="first">Crear una variable donde guardaremos nuestra API key. Escribir antes de la declaración de nuestro mapa</p>
<div class="highlight-python"><div class="highlight"><pre>var API_KEY = &#39;{TU_API_KEY}&#39;;
</pre></div>
</div>
</li>
<li><p class="first">Cargar la respuesta GeoJSON del servicio utilizando el plugin de Leaflet llamado <em>leaflet-ajax</em> <a class="footnote-reference" href="#id18" id="id8">[8]</a>. Este plugin permite hacer una llamada AJAX a un servicio que retorne un JSON y cargar la respuesta en un mapa. Agregar lo siguiente justo después de donde cargarmos el leaflet</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script src=&quot;https://calvinmetcalf.github.io/leaflet-ajax/dist/leaflet.ajax.js&quot;&gt;&lt;/script&gt;
</pre></div>
</div>
</li>
<li><p class="first">Agregar una capa de Isócronas al mapa llamando a la API de Mapzen utilizando el plugin. Agregar lo siguiente al final de nuestro código :</p>
<div class="highlight-python"><div class="highlight"><pre>var geojsonLayer = new L.GeoJSON.AJAX(&#39;https://matrix.mapzen.com/isochrone?json={&quot;locations&quot;:[{&quot;lat&quot;:41.40024,&quot;lon&quot;:2.180442}],&quot;costing&quot;:&quot;pedestrian&quot;,&quot;contours&quot;:[{&quot;time&quot;:15,&quot;color&quot;:&quot;ff0000&quot;}]}&amp;api_key=TU_API_KEY&#39;).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Recargar el mapa y comprobar que aparece una línea azul que representa la isócrona del punto dado. En este caso el punto seleccionado es fijo y está escrito en nuestro código.</p>
</li>
<li><p class="first">Modificar la aplicación para que se haga el cálculo de la Isócrona cuando el usuario haga click en un punto del mapa. Para ello primero hay que detectar el evento click en el mapa. Escribir luego de donde declaramos la capa geojson</p>
<div class="highlight-python"><div class="highlight"><pre>    map.on(&#39;click&#39;, function(e){
console.log(e);
    });
</pre></div>
</div>
</li>
<li><p class="first">Recargar la aplicación y abrir la consola del desarrollador. Hacer click sobre el mapa y ver que en la consola aparece el objeto del evento click. Inspeccionar este objeto y ver que tiene una propiedad llamada latlng que contine las coordenadas donde se ha hecho el click.</p>
</li>
<li><p class="first">Crear una función que tenga como parámetro una posición (coordenada lat lon) y genere una url de llamada al servicio de isócronas de Mapzen para que haga el cálculo en la coordenada indicada. Copiar lo siguiente al final de nuestro código:</p>
<div class="highlight-python"><div class="highlight"><pre>        function crearUrlIsochrona(latlng){
    var lat = latlng.lat;
    var lng = latlng.lng;
    var url = &#39;https://matrix.mapzen.com/isochrone?json=&#39;;
    var json = {
        locations: [{&quot;lat&quot;:lat, &quot;lon&quot;:lng}],
        costing: &quot;pedestrian&quot;,
        contours: [{&quot;time&quot;:15,&quot;color&quot;:&quot;ff0000&quot;}]
    };
    url += escape(JSON.stringify(json));
    url+= &#39;&amp;api_key=&#39;+API_KEY;
    return url;
}
</pre></div>
</div>
</li>
<li><p class="first">Llamar a la función <em>crearUrlIsochrona</em> cuando se hace click en el mapa. Escribir al final de la función del click</p>
<div class="highlight-python"><div class="highlight"><pre>var url = crearUrlIsochrona(e.latlng);
console.log(url);
</pre></div>
</div>
</li>
<li><p class="first">Recargar la página y hacer click sobre el mapa para ver que en la consola aparece una url. Abrir esta url en el navegador para comprobar que responde con un GeoJSON que contiene la isócrona.</p>
</li>
<li><p class="first">Utilizar el método refresh para actualizar la capa geojsonLayer con la nueva url. Escribir debajo de donde declaramos la variable url</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">geojsonLayer</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Refrescar el mapa y hacer click sobre el mapa para comprobar que se dibuja una nueva línea isócrona.</p>
</li>
<li><p class="first">Modificar la capa geojsonLayer para que se inicialice vacía sin ningún elemento. Modificar la declaración de la capa y borrar la url que llama a la API de Mapzen. Quedaría así:</p>
<div class="highlight-python"><div class="highlight"><pre>var geojsonLayer = new L.GeoJSON.AJAX(&#39;&#39;).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Pintar la línea del color que indicamos. Por defecto se pinta la línea de color azul a pesar de que en la llamada a la API estamos diciendo que el color es rojo (ff0000). Esto es debido a que el Leaflet no sabe de que color pintar la línea y utiliza el color por defecto. En la respuesta del servicio podemos ver que los elementos que nos retorna tienen unas propiedades (properties) en donde se listan una serie de estilos, uno de ellos es el color que si corresponde con el rojo. Lo que debemos hacer es decirle al leaflet que utilice esa propiedad para dar el color a la línea. Escribir lo siguiente en nuestra capa geojsonLayer.</p>
<div class="highlight-python"><div class="highlight"><pre>        var geojsonLayer = new L.GeoJSON.AJAX(&#39;&#39;,{
    style: function(geoJsonFeature){
        return {color: geoJsonFeature.properties.color};
    }
}).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Recargar el mapa y hacer click para confirmar que la línea es de color rojo.</p>
</li>
<li><p class="first">Calcular también la isócrona de 30 minutos. Hasta el momento pedíamos una isócrona de 15 minutos. Modificar el parámetro <em>contours</em> de nuestra función. Agregar otro objeto a la matriz de countours en este caso el tiempo (time) será de 30 y la línea será de color verde. Quedaría de la siguiente forma:</p>
<div class="highlight-python"><div class="highlight"><pre>contours: [{&quot;time&quot;:15,&quot;color&quot;:&quot;ff0000&quot;}, {&quot;time&quot;:30,&quot;color&quot;:&quot;00ff00&quot;}]
</pre></div>
</div>
</li>
<li><p class="first">Recargar el mapa y comprobar que ahora al hacer click aparecen 2 isócronas.</p>
</li>
</ol>
</div>
<div class="section" id="agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa">
<h3>Agregar un buscador de direcciones y puntos de interés al mapa<a class="headerlink" href="#agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa" title="Permalink to this headline">¶</a></h3>
<p>Para agregar un buscador utilizaremos el plugin de Leaflet <em>Leaflet.OpenCage.Search</em> <a class="footnote-reference" href="#id19" id="id9">[9]</a> desarrollado por OpenCage que permite de una forma fácil y rápida hacer llamadas al servicio de búsqueda de OpenCage Geocoder.</p>
<ol class="arabic">
<li><p class="first">Cargar la librería en nuestra aplicación. Copiar lo siguiente justo despúes de la carga del plugin de leaflet.ajax</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script src=&quot;http://rawgit.com/opencagedata/leaflet-opencage-search/master/dist/js/L.Control.OpenCageSearch.dev.js&quot;&gt;&lt;/script&gt;
</pre></div>
</div>
</li>
<li><p class="first">Cargar el estilo del plugin. Escribir lo siguiente justo debajo de donde cargamos el estilo de Leaflet</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;link rel=&quot;stylesheet&quot; href=&quot;http://rawgit.com/opencagedata/leaflet-opencage-search/master/dist/css/L.Control.OpenCageSearch.dev.css&quot; /&gt;
</pre></div>
</div>
</li>
<li><p class="first">Agregar el control al mapa. Para utilizar el servicio de búsqueda también es necesario pasar nuestra API key. Agregar lo siguiente antes de la declaración de nuestra función <em>crearUrlIsochrona</em> :</p>
<div class="highlight-python"><div class="highlight"><pre>var options_g = {
        key: &#39;{TU_API_KEY_OPENCAGE}&#39;,
        limit: 10
};
var geocoder = L.Control.openCageSearch(options_g).addTo(map);
</pre></div>
</div>
</li>
<li><p class="first">Recargar el mapa y comprobar que aparece el control.</p>
</li>
<li><p class="first">Calcular las isócronas al seleccionar un resultado de la búsqueda. Modificar la función <em>_geocodeResultSelected</em> del control geocoder</p>
<div class="highlight-python"><div class="highlight"><pre>geocoder._geocodeResultSelected = function(result){
        if (this.options.collapsed) {
                this._collapse();
        }
        console.log(result);
};
</pre></div>
</div>
</li>
<li><p class="first">Refrescar el mapa y abrir la consola de desarrolladores para comprobar que al seleccionar un resultado de la búsqueda aparece un objeto en la consola. Inspeccionar este objeto para ver que tiene una propiedad latlng que es lo que necesitamos para calcular las isócronas.</p>
</li>
<li><p class="first">Llamar a nuestra función <em>crearUrlIsochrona</em> en la función del evento select para generar la url, luego refrescar la capa de <em>geojsonLayer</em>. Esto ya lo hemos hecho cuando el usuario hace click en el mapa. Copiar lo siguiente en la función</p>
<div class="highlight-python"><div class="highlight"><pre>var url = crearUrlIsochrona(result.center);
geojsonLayer.refresh(url);
</pre></div>
</div>
</li>
<li><p class="first">Refrescar la página y al seleccionar un resultado de búsqueda comprobar que calcula las isócronas desde ese punto.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="capturar mapa cálculo de isócronas." class="align-middle" src="../_images/mapzen_isocrones.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="una-alternativa-al-servicio-de-isocronas-de-mapzen">
<h3>Una alternativa al servicio de Isócronas de Mapzen<a class="headerlink" href="#una-alternativa-al-servicio-de-isocronas-de-mapzen" title="Permalink to this headline">¶</a></h3>
<p>Utilizaremos el servicio de la API de Iso4App <a class="footnote-reference" href="#id20" id="id10">[10]</a> que también está basado en datos de OSM.</p>
<ol class="arabic">
<li><p class="first">Crear una función que tenga como parámetro una posición (coordenada lat lon) y genere una url de llamada al servicio de isócronas de Iso4App para que haga el cálculo en la coordenada indicada. Copiar lo siguiente al final de nuestro código:</p>
<div class="highlight-python"><div class="highlight"><pre>        function crearUrlIsochrona2(latlng){
    var lat = latlng.lat;
    var lng = latlng.lng;
    var url = &#39;http://www.iso4app.net/rest/1.3/isoline.geojson?&amp;type=isochrone&#39;;
    url+= &#39;&amp;value=&#39;+60*15;
    url+= &#39;&amp;lat=&#39;+lat+&#39;&amp;lng=&#39;+lng+&#39;&amp;mobility=pedestrian&#39;
    url+= &#39;&amp;licKey={TU_API_KEY_ISO4APP}&#39;;
    return url;
}
</pre></div>
</div>
</li>
<li><p class="first">Modificar la función que se llama al seleccionar un elemento del resultado de la búsqueda del geocodificador. En lugar de llamar a la función <em>crearUrlIsochrona</em> llamar a la nueva función <strong>crearUrlIsochrona2</strong>.</p>
</li>
<li><p class="first">Recargar la página y hacer click sobre el mapa para comprobar que se llama al servicio de Mapzen y se pintan dos isócronas.</p>
</li>
<li><p class="first">Hacer una búsqueda en el geocodificador y seleccionar un resultado para comprobar que se llama al servicio de Iso4App y se pinta una isócrona.</p>
</li>
</ol>
<div class="section" id="referencias">
<h4>Referencias<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h4>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://mapzen.com/documentation/mobility/">https://mapzen.com/documentation/mobility/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://mapzen.com/products/search/geocoding/">https://mapzen.com/products/search/geocoding/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://mapzen.com/documentation/mapzen-js/">https://mapzen.com/documentation/mapzen-js/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://leafletjs.com/">http://leafletjs.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="https://bl.ocks.org/rfriberg/38694be3e8ffb30ac6ac8302960c7ebd">https://bl.ocks.org/rfriberg/38694be3e8ffb30ac6ac8302960c7ebd</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="https://mapzen.com/documentation/mobility/isochrone/api-reference/">https://mapzen.com/documentation/mobility/isochrone/api-reference/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td><a class="reference external" href="https://mapzen.com/developers/sign_up">https://mapzen.com/developers/sign_up</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[8]</a></td><td><a class="reference external" href="https://github.com/calvinmetcalf/leaflet-ajax">https://github.com/calvinmetcalf/leaflet-ajax</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[9]</a></td><td><a class="reference external" href="https://github.com/OpenCageData/leaflet-opencage-search">https://github.com/OpenCageData/leaflet-opencage-search</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id20" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[10]</a></td><td><a class="reference external" href="https://www.iso4app.net/">https://www.iso4app.net/</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>