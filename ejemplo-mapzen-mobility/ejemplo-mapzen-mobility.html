<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ejemplo Mapzen Mobility &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
    <link rel="next" title="¿Cómo crear un geoservicio?" href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html" />
    <link rel="prev" title="Utilización de geoservicios realtime" href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html">Introducción a las Smart Cities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduccion-smart-cities/introduccion-smart-cities.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html">Conceptos básicos de Geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-geoservicios/conceptos_geoservicios.html#geoservicio">Geoservicio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html">Geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geoservicios-realtime/geoservicios-realtime.html#creacion-de-un-servicio-realtime-para-compartir-la-ubicacion">Creación de un servicio realtime para compartir la ubicación</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html">Conceptos sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-sensores/conceptos-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html">Servicios realtime sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-sensores/servicios-realtime-sensores.html#algunos-problemas-que-nos-encontraremos-al-trabar-con-sensores">Algunos problemas que nos encontraremos al trabar con sensores</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html">Conceptos Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../conceptos-opendata/conceptos-opendata.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html">Herramientas de visualización Opendata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-opendata/herramientas-visualizacion-opendata.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-opendata/utilizacion-servicio-opendata.html">Utilización de servicios Open data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html">Servicios realtime Open data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../servicios-realtime-opendata/servicios-realtime-opendata.html#algunos-problemas-que-nos-encontraremos-al-trabar-con-servicios-open-data">Algunos problemas que nos encontraremos al trabar con servicios Open Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html">Ejemplo servicio bicing Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-servicio-bicing-bcn/ejemplo-servicio-bicing-bcn.html#acceso-al-servicio-de-datos-del-bicing-de-barcelona">Acceso al servicio de datos del Bicing de Barcelona</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html">Utilización de servicios de sensores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-servicio-sensores/utilizacion-servicio-sensores.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html">Ejemplo sensores port Barcelona</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.html#acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona">Acceso al servicio de datos de sensores del Port de Barcelona</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html">Ejemplo Sentilo ACA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ejemplo-sentilo-aca/ejemplo-sentilo-aca.html#acceso-al-servicios-de-sensores-sentilo-de-la-aca">Acceso al servicios de sensores Sentilo de la ACA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html">Herramientas de visualización geoservicios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#librerias">Librerias</a></li>
<li class="toctree-l2"><a class="reference internal" href="../herramientas-visualizacion-geoservicios/herramientas-visualizacion-geoservicios.html#servicios">Servicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html">Utilización de geoservicios realtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html#apartado">Apartado</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Ejemplo Mapzen Mobility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#acceso-a-los-servicios-de-mapzen-mobility">Acceso a los servicios de Mapzen Mobility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html">¿Cómo crear un geoservicio?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html#apartado">Apartado</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Ejemplo Mapzen Mobility</a><ul>
<li><a class="reference internal" href="#acceso-a-los-servicios-de-mapzen-mobility">Acceso a los servicios de Mapzen Mobility</a><ul>
<li><a class="reference internal" href="#creacion-de-un-visor-que-permita-el-caculo-de-isocronas">Creación de un visor que permita el cáculo de Isócronas</a></li>
<li><a class="reference internal" href="#agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa">Agregar un buscador de direcciones y puntos de interés al mapa</a><ul>
<li><a class="reference internal" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../utilizacion-geoservicio-realtime/utilizacion-geoservicio-realtime.html" title="Previous Chapter: Utilización de geoservicios realtime"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Utilización d...</span>
    </a>
  </li>
  <li>
    <a href="../como-crear-un-geoservicio/como-crear-un-geoservicio.html" title="Next Chapter: ¿Cómo crear un geoservicio?"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">¿Cómo crear u... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ejemplo-mapzen-mobility/ejemplo-mapzen-mobility.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="ejemplo-mapzen-mobility">
<h1>Ejemplo Mapzen Mobility<a class="headerlink" href="#ejemplo-mapzen-mobility" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8 Noviembre 2017</td>
<td><ul class="first last simple">
<li>Wladimir Szczerban</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>X Noviembre 2017</td>
<td><ul class="first last simple">
<li>Victor Pascual</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2017 Wladimir Szczerban</p>
</div></blockquote>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia: Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="acceso-a-los-servicios-de-mapzen-mobility">
<h2>Acceso a los servicios de Mapzen Mobility<a class="headerlink" href="#acceso-a-los-servicios-de-mapzen-mobility" title="Permalink to this headline">¶</a></h2>
<p>Mapzen Mobility <a class="footnote-reference" href="#id10" id="id1">[1]</a> es un kit de herramientas para el transporte multimodal, está basado en software libre y usa datos abiertos (principalmente datos de OpenStreetMap). Consta de varias herramientas como son:
- Mapzen Turn-by-Turn: es un servicio de navegación para el mundo, ya sea en automóvil, bicicleta, pie y combinaciones multimodales que implican caminar y andar en transporte público.
- Mapzen Matrix: servicio que calcula la tabla de distancia y tiempo entre diferentes lugares.
- Mapzen Isochrone: servicio para obtener un cálculo de las áreas que se pueden alcanzar dentro de períodos de tiempo específicos desde una ubicación o un conjunto de ubicaciones.
- Mapzen Map Matching: servicio que permite convertir una ruta en una ruta con instrucciones narrativas. Esto lo hace observando las coordenadas que coincide con las coordenadas de las carreteras conocidas y así obtener los valores de los atributos de esa línea coincidente.</p>
<p>Otro servicio interesante de Mapzen es el servicio de búsqueda que permite geocodificar direcciones, o buscar puntos de interés. <a class="footnote-reference" href="#id11" id="id2">[2]</a></p>
<p>Mapzen tiene una librería Mapzen JavaScript SDK <a class="footnote-reference" href="#id12" id="id3">[3]</a> que está basada en Leaflet <a class="footnote-reference" href="#id13" id="id4">[4]</a> que facilita el uso de los diferentes servicios de Mapzen. Aqui <a class="footnote-reference" href="#id14" id="id5">[5]</a> se puede ver un ejemplo del cálculo de Isócronas utilizando la librería js de Mapzen.</p>
<p>En nuestro caso crearemos un visor utilizando Leaflet y llamando directamente al servicio de Mapzen.</p>
<div class="section" id="creacion-de-un-visor-que-permita-el-caculo-de-isocronas">
<h3>Creación de un visor que permita el cáculo de Isócronas<a class="headerlink" href="#creacion-de-un-visor-que-permita-el-caculo-de-isocronas" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">En nuestro ordenador creamos una carpeta con el nombre de <em>visor-port</em>.</p>
</li>
<li><p class="first">Dentro de esta carpeta creamos un archivo con el nombre de <em>index.html</em>.</p>
</li>
<li><dl class="first docutils">
<dt>Abrimos el archivo index.html con un editor de texto y copiamos el siguiente código.::</dt>
<dd><p class="first">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;</p>
<blockquote>
<div><blockquote>
<div><p>&lt;meta charset=&#8221;UTF-8&#8221;&gt;</p>
</div></blockquote>
<p>&lt;meta name=&#8221;viewport&#8221; content=&#8221;width=device-width, initial-scale=1.0&#8221;&gt;
&lt;meta http-equiv=&#8221;X-UA-Compatible&#8221; content=&#8221;ie=edge&#8221;&gt;</p>
<blockquote>
<div><p>&lt;title&gt;Ejemplo Isócronas Mapzen&lt;/title&gt;
&lt;link rel=&#8221;stylesheet&#8221; href=&#8221;<a class="reference external" href="https://unpkg.com/leaflet&#64;1.2.0/dist/leaflet.css">https://unpkg.com/leaflet&#64;1.2.0/dist/leaflet.css</a>&#8221; /&gt;
&lt;style&gt;
#map {</p>
<blockquote>
<div><p>height: 100%;
width: 100%;
position: absolute;</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>&lt;/style&gt;</p>
</div></blockquote>
<p>&lt;/head&gt;
&lt;body&gt;</p>
<blockquote>
<div><blockquote>
<div><p>&lt;div id=&#8221;map&#8221;&gt;</p>
</div></blockquote>
<p>&lt;/div&gt;</p>
<blockquote>
<div><p>&lt;script src=&#8221;<a class="reference external" href="https://unpkg.com/leaflet&#64;1.2.0/dist/leaflet.js">https://unpkg.com/leaflet&#64;1.2.0/dist/leaflet.js</a>&#8220;&gt;&lt;/script&gt;
&lt;script&gt;</p>
<blockquote>
<div><p>var map = L.map(&#8216;map&#8217;);</p>
</div></blockquote>
<p>map.setView([41.3887, 2.1777], 13);</p>
<dl class="docutils">
<dt>L.tileLayer(&#8216;<a class="reference external" href="http:/">http:/</a>/{s}.tile.osm.org/{z}/{x}/{y}.png&#8217;, {</dt>
<dd><p class="first last">attribution: &#8216;&amp;copy; &lt;a href=&#8221;<a class="reference external" href="http://osm.org/copyright">http://osm.org/copyright</a>&#8220;&gt;OpenStreetMap&lt;/a&gt; contributors&#8217;</p>
</dd>
</dl>
<p>}).addTo(map);
&lt;/script&gt;</p>
</div></blockquote>
</div></blockquote>
<p class="last">&lt;/body&gt;
&lt;/html&gt;</p>
</dd>
</dl>
</li>
<li><p class="first">Abrimos el archivo index.html en el navegador y vemos que se nos carga un mapa centrado en Barcelona.</p>
</li>
<li><p class="first">En la documentación de la API del servicio de Mapzen Isochrone <a class="footnote-reference" href="#id15" id="id6">[6]</a> vemos que es necesario tener una API key para poder utilizarlo. Para crear una API key hay que darse de alta en la página de Mapzen <a class="footnote-reference" href="#id16" id="id7">[7]</a>, tiene una verisón gratuita que tiene unas cuotas de uso. Si se quiere hacer un uso más intesivo del servicio hay que pagar.</p>
</li>
<li><dl class="first docutils">
<dt>En nuestro código javascript crearemos una variable donde guardaremos nuestra API key. Antes de la declaración de nuestro mapa escribimos ::</dt>
<dd><p class="first last">var API_KEY = &#8216;TU_API_KEY&#8217;;</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Consultado la documentación observamos que la respuesta del servicio es un GeoJSON, para cargar este GeoJSON en nuestro mapa utilizaremos un plugin de Leaflet llamado <em>leaflet-ajax</em> <a class="footnote-reference" href="#id17" id="id8">[8]</a>. Este plugin nos permite hacer una llama AJAX a un servicio que retorne un JSON y cargar la respuesta en un mapa. Para cargar este plugin debemos agregar lo siguiente justo después de donde cargarmos el leaflet ::</dt>
<dd><p class="first last">&lt;script src=&#8221;<a class="reference external" href="https://calvinmetcalf.github.io/leaflet-ajax/dist/leaflet.ajax.js">https://calvinmetcalf.github.io/leaflet-ajax/dist/leaflet.ajax.js</a>&#8220;&gt;&lt;/script&gt;</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Para agregar una capa de Isócronas al mapa llamaremos a la API de Mapzen utilizando el plugin. Para ello al final de nuestro código agregamos lo siguiente: ::</dt>
<dd><p class="first last">var geojsonLayer = new L.GeoJSON.AJAX(&#8216;<a class="reference external" href="https://matrix.mapzen.com/isochrone">https://matrix.mapzen.com/isochrone</a>?json={&#8220;locations&#8221;:[{&#8220;lat&#8221;:41.40024,&#8221;lon&#8221;:2.180442}],&#8221;costing&#8221;:&#8221;pedestrian&#8221;,&#8221;contours&#8221;:[{&#8220;time&#8221;:15,&#8221;color&#8221;:&#8221;ff0000&#8221;}]}&amp;api_key=TU_API_KEY&#8217;).addTo(map);</p>
</dd>
</dl>
</li>
<li><p class="first">Si recargamos el mapa vemos que nos aparece una línea azul que representa la isócrona del punto dado. En este caso el punto seleccionado es fijo y está escrito en nuestro código.</p>
</li>
<li><dl class="first docutils">
<dt>Modificar nuestra aplicación para que se haga el cálculo de la Isócrona cuando el usuario haga click en un punto del mapa. Para esto primero tendremos que detectar el evento click en el mapa. Luego de donde declaramos la capa geojson escribimos ::</dt>
<dd><blockquote class="first">
<div><p>map.on(&#8216;click&#8217;, function(e){</p>
</div></blockquote>
<dl class="last docutils">
<dt>console.log(e);</dt>
<dd><p class="first last">});</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><p class="first">Recargamos la aplicación y abrimos la consola del desarrollador, al hacer click sobre el mapa, en la consola aparece el objeto del evento click. Si inspeccionamos este objeto vemos que tiene una propiedad llamada latlng que contine las coordenadas donde se ha hecho el click.</p>
</li>
<li><dl class="first docutils">
<dt>Crearemos una función que tenga como parámetro una posición (coordenada lat lon) y nos genere una url de llamada al servicio de isócronas de Mapzen para que haga el cálculo en la coordenada indicada. Al final de nuestro código copiamos lo siguiente: ::</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><p>function crearUrlIsochrona(latlng){</p>
</div></blockquote>
<p>var lat = latlng.lat;
var lng = latlng.lng;
var url = &#8216;<a class="reference external" href="https://matrix.mapzen.com/isochrone?json=">https://matrix.mapzen.com/isochrone?json=</a>&#8216;;
var json = {</p>
<blockquote>
<div><p>locations: [{&#8220;lat&#8221;:lat, &#8220;lon&#8221;:lng}],
costing: &#8220;pedestrian&#8221;,
contours: [{&#8220;time&#8221;:15,&#8221;color&#8221;:&#8221;ff0000&#8221;}]</p>
</div></blockquote>
<p>};
url += escape(JSON.stringify(json));
url+= &#8216;&amp;api_key=&#8217;+API_KEY;
return url;</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Esta función la llamaremos cuando se hace click en el mapa. Al final de la función del click escribimos ::</dt>
<dd><p class="first last">var url = crearUrlIsochrona(e.latlng);
console.log(url);</p>
</dd>
</dl>
</li>
<li><p class="first">Recargamos la página hacemos click sobre el mapa y vemos que en la consola nos aparece una url. Si abrimos esta url en el navegador nos responde con un GeoJSON que contiene la isócrona.</p>
</li>
<li><dl class="first docutils">
<dt>Actualizamos la capa geojsonLayer con la nueva url, para actualizar la capa utilizaremos el metodo refresh. Debajo de donde declaramos la variable url escribimos ::</dt>
<dd><p class="first last">geojsonLayer.refresh(url);</p>
</dd>
</dl>
</li>
<li><p class="first">Refrescamos el mapa y al hacer click sobre el mapa vemos que se nos dibuja una nueva línea isócrona.</p>
</li>
<li><dl class="first docutils">
<dt>Modificamos la capa geojsonLayer para que se inicialice vacía sin ningún elemento. Para ello modificamos la declaración de la capa y borramos la url que llama a la API de Mapzen. Nos quedaría así: ::</dt>
<dd><p class="first last">var geojsonLayer = new L.GeoJSON.AJAX(&#8216;&#8217;).addTo(map);</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Vemos que por defecto nos pinta la línea de color azul a pesar de que en la llamada a la API le estamos diciendo que el color es rojo (ff0000). Esto es debido a que el Leaflet no sabe de que color pintar la línea y utiliza el color por defecto. En la respuesta del servicio podemos ver que los elementos que nos retorna tienen unas propiedades (properties) en donde se listan una serie de estilos, uno de ellos es el color que si corresponde con el rojo. Ahora lo que debemos hacer es decirle al leaflet que utilice esa propiedad para dar el color a la línea. Para ellos escribiremos lo siguiente en nuestra capa geojsonLayer. ::</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><p>var geojsonLayer = new L.GeoJSON.AJAX(&#8216;&#8217;,{</p>
</div></blockquote>
<dl class="docutils">
<dt>style: function(geoJsonFeature){</dt>
<dd><p class="first last">return {color: geoJsonFeature.properties.color};</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p class="last">}).addTo(map);</p>
</dd>
</dl>
</li>
<li><p class="first">Ahora si recargamos el mapa y hacemos click vemos que las líneas son de color rojo.</p>
</li>
<li><dl class="first docutils">
<dt>Hasta el momento pedíamos una isócrona de 15 minutos ahora añadiremos para que nos calcule también la isócrona de 30 minutos. Para ellos debemos modificar el parámetro <em>contours</em> de nuestra función. Le agregaremos otro objeto a la matriz de countours pero en este caso el tiempo (time) será de 30 y la línea será de color verde. Nos quedaría de la siguiente forma: ::</dt>
<dd><p class="first last">contours: [{&#8220;time&#8221;:15,&#8221;color&#8221;:&#8221;ff0000&#8221;}, {&#8220;time&#8221;:30,&#8221;color&#8221;:&#8221;00ff00&#8221;}]</p>
</dd>
</dl>
</li>
<li><p class="first">Recargamos el mapa y vemos que ahora al hacer click nos aparecen 2 isócronas.</p>
</li>
</ol>
</div>
<div class="section" id="agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa">
<h3>Agregar un buscador de direcciones y puntos de interés al mapa<a class="headerlink" href="#agregar-un-buscador-de-direcciones-y-puntos-de-interes-al-mapa" title="Permalink to this headline">¶</a></h3>
<p>Para agregar un buscador utilizaremos el plugin de Leaflet <em>leaflet-geocoder</em> <a class="footnote-reference" href="#id18" id="id9">[9]</a> desarrollado por Mapzen que permite de una forma fácil y rápida hacer llamadas al servicio de búsqueda de Mapzen.</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Cargamos la librería en nuestra aplicación. Para ellos debemos copiar lo siguiente justo despúes de la carga del plugin de leaflet.ajax ::</dt>
<dd><p class="first last">&lt;script src=&#8221;<a class="reference external" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.js">https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.js</a>&#8220;&gt;&lt;/script&gt;</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Agregamos el control al mapa. Para utilizar el servicio de búsqueda tambíen es necesario pasar nuestra API key. Antes de la declaraciṕn de nuestra función <em>crearUrlIsochrona</em> agregamos lo siguiente: ::</dt>
<dd><p class="first last">var geocoder = L.control.geocoder(API_KEY).addTo(map);</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Recargamos el mapa y vemos que nos aparece el control de búsqueda. Vemos que funciona pero que no tiene estilo, esto es debido a que no hemos cargado el estilo del control. Para esto debemos escribir lo siguiente justo debajo de donde cargamos el estilo de Leaflet ::</dt>
<dd><p class="first last">&lt;link rel=&#8221;stylesheet&#8221; href=&#8221;<a class="reference external" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css">https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css</a>&#8220;&gt;</p>
</dd>
</dl>
</li>
<li><p class="first">Volvemos a recargar y ahora si nos aparece el control con estilo.</p>
</li>
<li><dl class="first docutils">
<dt>Calcular las isócronas al seleccionar un resultado de la búsqueda. Para ello utilizaremos el evento <em>select</em> del control geocoder::</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><p>geocoder.on(&#8216;select&#8217;, function (e) {</p>
</div></blockquote>
<p>console.log(e);</p>
</div></blockquote>
<p class="last">});</p>
</dd>
</dl>
</li>
<li><p class="first">Si refrescamos el mapa y abrimos la consola de desarrollados vemos que al seleccionar un resultado de la búsqueda no aparece un objeto en la consola. Si inspeccionamos este objeto vemos que tiene una propiedad latlng que es lo que necesitamos para calcular las isócronas.</p>
</li>
<li><dl class="first docutils">
<dt>En la función del evento select debemos llamar a nuestra función <em>crearUrlIsochrona</em> para generar la url y luego refrescar la capa de <em>geojsonLayer</em>, esto ya que hemos hecho cuando el usuario hace click en el mapa. Por lo tanto copiamos lo siguiente en la función ::</dt>
<dd><blockquote class="first">
<div><p>var url = crearUrlIsochrona(e.latlng);</p>
</div></blockquote>
<p class="last">geojsonLayer.refresh(url);</p>
</dd>
</dl>
</li>
<li><p class="first">Refrescamos la página y al seleccionar un resultado de búsqueda nos calculá las isócronas desde ese punto.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="capturar mapa cálculo de isócronas." class="align-middle" src="../_images/mapzen_isocrones.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ol>
<div class="section" id="referencias">
<h4>Referencias<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h4>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://mapzen.com/documentation/mobility/">https://mapzen.com/documentation/mobility/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://mapzen.com/products/search/geocoding/">https://mapzen.com/products/search/geocoding/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://mapzen.com/documentation/mapzen-js/">https://mapzen.com/documentation/mapzen-js/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://leafletjs.com/">http://leafletjs.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="https://bl.ocks.org/rfriberg/38694be3e8ffb30ac6ac8302960c7ebd">https://bl.ocks.org/rfriberg/38694be3e8ffb30ac6ac8302960c7ebd</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="https://mapzen.com/documentation/mobility/isochrone/api-reference/">https://mapzen.com/documentation/mobility/isochrone/api-reference/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td><a class="reference external" href="https://mapzen.com/developers/sign_up">https://mapzen.com/developers/sign_up</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[8]</a></td><td><a class="reference external" href="https://github.com/calvinmetcalf/leaflet-ajax">https://github.com/calvinmetcalf/leaflet-ajax</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[9]</a></td><td><a class="reference external" href="https://github.com/mapzen/leaflet-geocoder">https://github.com/mapzen/leaflet-geocoder</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>