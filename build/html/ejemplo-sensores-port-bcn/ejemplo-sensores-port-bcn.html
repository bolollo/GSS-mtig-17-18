<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ejemplo sensores port Barcelona &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="simple">
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Ejemplo sensores port Barcelona</a><ul>
<li><a class="reference internal" href="#acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona">Acceso al servicio de datos de sensores del Port de Barcelona</a><ul>
<li><a class="reference internal" href="#creacion-de-un-visor">Creación de un visor</a><ul>
<li><a class="reference internal" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ejemplo-sensores-port-bcn/ejemplo-sensores-port-bcn.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="ejemplo-sensores-port-barcelona">
<h1>Ejemplo sensores port Barcelona<a class="headerlink" href="#ejemplo-sensores-port-barcelona" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8 Noviembre 2017</td>
<td><ul class="first last simple">
<li>Wladimir Szczerban</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>X Noviembre 2017</td>
<td><ul class="first last simple">
<li>Victor Pascual</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2017 Wladimir Szczerban</p>
</div></blockquote>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia: Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona">
<h2>Acceso al servicio de datos de sensores del Port de Barcelona<a class="headerlink" href="#acceso-al-servicio-de-datos-de-sensores-del-port-de-barcelona" title="Permalink to this headline">¶</a></h2>
<p>El <cite>portal de sensores del Port de Barcelona &lt;http://sensors.portdebarcelona.cat/?lang=es&gt;</cite> contiene una serie de componentes gráficos o widgets que permiten acceder a los datos de los diferentes sensores SOS <a class="footnote-reference" href="#id6" id="id1">[1]</a>. También podemos acceder directamente al servicio <a class="reference external" href="http://sensors.portdebarcelona.cat/sos/json">http://sensors.portdebarcelona.cat/sos/json</a> si queremos implementar nuestros propios componentes o procesar los datos directamente.</p>
<p>Estos widgets implementan un cliente SOS que soporta la versión 2.0 de estándard, y, en estos momentos, necesitan un endpoint en formato JSON, que resulta no ser un requisito del estándar, sino una funcionalidad opcional que proporciona la implementación de servidor SOS de 52 north en su versión 4.0.0 o superior.</p>
<p>La ventaja de utilizar los widgets es que agregan una capa de abstracción que hace el trabajo sucio y nos evita trabajar directamente con el servicio.</p>
<p>La implementación de los widgets es open source <a class="footnote-reference" href="#id7" id="id2">[2]</a> y extensible lo que nos permite poder desarrollar nuestros propios widgets.</p>
<div class="section" id="creacion-de-un-visor">
<h3>Creación de un visor<a class="headerlink" href="#creacion-de-un-visor" title="Permalink to this headline">¶</a></h3>
<p>Para crear un visor de mapas utilizaremos el widget de Mapa <a class="footnote-reference" href="#id8" id="id3">[3]</a> que está basado en la librería de mapas Leaflet <a class="footnote-reference" href="#id9" id="id4">[4]</a>.</p>
<ol class="arabic">
<li><p class="first">En nuestro ordenador creamos una carpeta con el nombre de <em>visor-port</em>.</p>
</li>
<li><p class="first">Dentro de esta carpeta creamos un archivo con el nombre de <em>index.html</em>.</p>
</li>
<li><dl class="first docutils">
<dt>Abrimos el archivo index.html con un editor de texto y copiamos el siguiente código.::</dt>
<dd><p class="first">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;</p>
<blockquote>
<div><blockquote>
<div><p>&lt;title&gt;Sensores Port de Barcelona&lt;/title&gt;
style&gt;
#map-container {</p>
<blockquote>
<div><p>position: absolute;
top: 0;
left: 0;
bottom: 0;
right: 0;</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>&lt;/style&gt;</p>
</div></blockquote>
<p>&lt;/head&gt;
&lt;body&gt;</p>
<blockquote>
<div><blockquote>
<div><p>&lt;div id=&#8221;map-container&#8221;&gt;&lt;/div&gt;</p>
</div></blockquote>
<p>&lt;script src=&#8221;<a class="reference external" href="http://sensors.portdebarcelona.cat/js/SensorWidgets.js">http://sensors.portdebarcelona.cat/js/SensorWidgets.js</a>&#8220;&gt;&lt;/script&gt;
&lt;script type=&#8221;text/javascript&#8221;&gt;</p>
<blockquote>
<div><dl class="docutils">
<dt>SensorWidget(&#8216;map&#8217;, {</dt>
<dd><blockquote class="first">
<div><p>&#8220;service&#8221;: &#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/sos/json">http://sensors.portdebarcelona.cat/sos/json</a>&#8221;,
&#8220;offering&#8221;: &#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/offerings#30m">http://sensors.portdebarcelona.cat/def/weather/offerings#30m</a>&#8221;,
&#8220;swap_axis&#8221;: true,
&#8220;features&#8221;: [],
&#8220;properties&#8221;: []</p>
</div></blockquote>
<p class="last">}, document.getElementById(&#8216;map-container&#8217;));</p>
</dd>
</dl>
</div></blockquote>
<p>&lt;/script&gt;</p>
</div></blockquote>
<p class="last">&lt;/body&gt;
&lt;/html&gt;</p>
</dd>
</dl>
</li>
<li><p class="first">Abrimos el archivo index.html en el navegador y vemos que se nos carga un mapa del mundo. Este mapa no contiene ninguna información.</p>
</li>
<li><dl class="first docutils">
<dt>Agregamos algunas features (sensores) en la matriz de features. Para obtenter la features tendríamos que hacer una peticón de GetFeatureOfInterest <a class="footnote-reference" href="#id10" id="id5">[5]</a> .Para agregar algunos elementos en nuestro mapa reemplazamos la propiedad features por lo siguiente: ::</dt>
<dd><dl class="first docutils">
<dt>&#8220;features&#8221;: [</dt>
<dd><p class="first last">&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/features#01">http://sensors.portdebarcelona.cat/def/weather/features#01</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/features#02">http://sensors.portdebarcelona.cat/def/weather/features#02</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/features#03">http://sensors.portdebarcelona.cat/def/weather/features#03</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/features#P4">http://sensors.portdebarcelona.cat/def/weather/features#P4</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/features#10">http://sensors.portdebarcelona.cat/def/weather/features#10</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/features#P5">http://sensors.portdebarcelona.cat/def/weather/features#P5</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/features#P6">http://sensors.portdebarcelona.cat/def/weather/features#P6</a>&#8220;</p>
</dd>
</dl>
<p class="last">],</p>
</dd>
</dl>
</li>
<li><p class="first">Recargamos el mapa y vemos que nos aparecen unos puntos en el puerto de Barcelona.</p>
</li>
<li><dl class="first docutils">
<dt>Ya tenemos algunos sensores en nuestro mapa pero no tenemos ningún dato. Para ver algunos valores tendremos que indicar que propiedades queremos observar. Esto lo indicaremos en la matriz de properties de nuestro mapa. Para ver la temperatúra agregamos las siguientes propiedades: ::</dt>
<dd><blockquote class="first">
<div><p>&#8220;properties&#8221;: [
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/properties#32M">http://sensors.portdebarcelona.cat/def/weather/properties#32M</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/properties#32">http://sensors.portdebarcelona.cat/def/weather/properties#32</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/properties#32N">http://sensors.portdebarcelona.cat/def/weather/properties#32N</a>&#8220;</p>
</div></blockquote>
<p class="last">],</p>
</dd>
</dl>
</li>
<li><p class="first">Ahora si recargamos el mapa y pasamos el cursor sobre algún elemento vemos que se despliega un panel con las temperaturas.</p>
</li>
<li><dl class="first docutils">
<dt>En nuestro mapa podemos combinar varios widgets por ejemplo podemos hacer que al hacer click sobre un elemento se muestre un popup con un widget. Pare ellos debemos utilizar la opción <em>popup_widget</em> del mapa. En este caso cargaremos un widget de tipo serie de tiempoi con las temperaturas. En nuestro mapa justo debajo de las propertities escribimos lo siguiente: ::</dt>
<dd><dl class="first docutils">
<dt>&#8220;popup_widget&#8221;: {</dt>
<dd><p class="first">&#8220;name&#8221;: &#8220;timechart&#8221;,
&#8220;title&#8221;: &#8220;Temperatures&#8221;,
&#8220;properties&#8221;: [</p>
<blockquote>
<div><p>&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/properties#32M">http://sensors.portdebarcelona.cat/def/weather/properties#32M</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/properties#32">http://sensors.portdebarcelona.cat/def/weather/properties#32</a>&#8221;,
&#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/properties#32N">http://sensors.portdebarcelona.cat/def/weather/properties#32N</a>&#8220;</p>
</div></blockquote>
<p class="last">],
&#8220;time_start&#8221;: &#8220;2015-09-03T05:05:40Z&#8221;,
&#8220;time_end&#8221;: &#8220;2015-09-03T08:05:40Z&#8221;</p>
</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</li>
<li><p class="first">Recargamos la página y al hacer click sobre un elemento se nos muestra un popup con una serie temporal de las temperaturas.</p>
</li>
<li><dl class="first docutils">
<dt>También podemos hacer que al clicar sobre un elemento se nos muestre un widget en un elemento fuera del mapa. Para ellos vamos a crear un nuevo div. En nuestro html juesto debajo de donde declaramos el div del mapa escribimos ::</dt>
<dd><p class="first last">&lt;div id=&#8221;info-container&#8221;&gt;&lt;/div&gt;</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>En nuestro apartado de estilo creamos un nuevo estilo para este elemento. ::</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><p>#info-container {
position: absolute;</p>
</div></blockquote>
<p>top: 0;
left: 0;
width: &#8220;200px&#8221;;
z-index: 9000;
background-color: rgba(255,255,255,0.7);</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>En nuestro mapa quitaremos la opción de <em>popup_widget</em> y en este caso utilizaremos la opción de <em>on_click</em> que llama a una función que se ejecuta al hacer click sobre un elemento del mapa. Debajo de las properties copiamos lo siguiente: ::</dt>
<dd><dl class="first docutils">
<dt>&#8220;on_click&#8221;: function(el){</dt>
<dd><p class="first last">console.log(el);</p>
</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</li>
<li><p class="first">Recargamos el mapa, abrimos la consola de desarrollador del navegador y hacer click sobre un elemento. Podemos observar que no pasa nada. Esto es debido a que esta funcionalidad no está implementada en la librería SensorWidgets que estamos utilizando. Para que esto nos funcione vamos a utilizar una nueva versión de esta librería que está en la página del desarrollador de los Widgets (Oscar Fonts). Para ellos en nuestro html debemos cargar <strong>http://sensors.fonts.cat/js/SensorWidgets.js</strong> en lugar de <em>http://sensors.portdebarcelona.cat/js/SensorWidgets.js</em>.</p>
</li>
<li><p class="first">Volvemos a cargar la página y ahora al hacer click sobre un elemento en la consola de desarrollador nos aparece la información del elemento clicado.</p>
</li>
<li><dl class="first docutils">
<dt>Creamos una función que dado el id de un elemento nos cree un widget de tipo termómetro. Antes de donde cerramos el tag de script escribimos ::</dt>
<dd><dl class="first docutils">
<dt>function showTermometro(feature){</dt>
<dd><dl class="first docutils">
<dt>SensorWidget(&#8216;thermometer&#8217;, {</dt>
<dd><p class="first last">&#8220;service&#8221;: &#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/sos/json">http://sensors.portdebarcelona.cat/sos/json</a>&#8221;,
&#8220;offering&#8221;: &#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/offerings#30m">http://sensors.portdebarcelona.cat/def/weather/offerings#30m</a>&#8221;,
&#8220;feature&#8221;: feature,
&#8220;property&#8221;: &#8220;<a class="reference external" href="http://sensors.portdebarcelona.cat/def/weather/properties#32">http://sensors.portdebarcelona.cat/def/weather/properties#32</a>&#8221;,
&#8220;refresh_interval&#8221;: 120,
&#8220;footnote&#8221;: &#8220;A sample footnote for Thermometer widget&#8221;</p>
</dd>
</dl>
<p class="last">}, document.getElementById(&#8216;info-container&#8217;));</p>
</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Dentro de la función del <em>on_click</em> llamaremos a nuestra nueva función. Luego del console.log escribimos: ::</dt>
<dd><p class="first last">showTermometro(el.feature.id);</p>
</dd>
</dl>
</li>
<li><p class="first">Ahora si recargamos nuestro mapa y hacemos click sobre un elemento se desplega el widget del termómetro con la temperatura actual.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="capturar mapa de sensores del port de barcelona" class="align-middle" src="../_images/sensores_port_bcn.png" /></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ol>
<div class="section" id="referencias">
<h4>Referencias<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h4>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://sensor-widgets.readthedocs.io/es/latest/sos.html">http://sensor-widgets.readthedocs.io/es/latest/sos.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://github.com/oscarfonts/sensor-widgets">https://github.com/oscarfonts/sensor-widgets</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="http://sensor-widgets.readthedocs.io/es/latest/widgets.html#mapa-map">http://sensor-widgets.readthedocs.io/es/latest/widgets.html#mapa-map</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://leafletjs.com/">http://leafletjs.com/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="http://sensor-widgets.readthedocs.io/es/latest/sos.html#getfeatureofinterest">http://sensor-widgets.readthedocs.io/es/latest/sos.html#getfeatureofinterest</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>